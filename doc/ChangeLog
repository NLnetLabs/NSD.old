27 September 2006: Wouter
	- Further suggestion from Koh-ichi Ito, I've set opt->xfrdfile
	  to XFRDFILE in options_create. So opt->xfrdfile and opt->difffile
	  are never NULL. This simplifies code elsewhere.
	  And also handles chroot case (+=l) for default values.
	- Fix for bug #145. The skip file position in the diff file was used
	  inconsistently - one part of the code skipped to before the 'IXFR'
	  type code and another part skipped to after that. Now all skip to
	  before the type code. This bug only happens if your diff file 
	  is like: zone1_part1, zone2_part_1, zone1_part2, zone1_commit,
	    zone2_part2, zone2_commit. The skip over zone1_part1 failed.
	- tpkg test in long dir that tests for the bugfix. Takes a long time
	  and uses ldns-testns feature to wait partway through an AXFR.

26 September 2006: Wouter
	- NSD compiles on Solaris 10 with the sun cc compiler.
	  Added a define for _STDC_C99 for that.
	- Checked that the patch for solaris for bug 143 indeed fixes the bug.
	- Fixed bug #146 reported by Koh-ichi Ito: when chrooted nsd failed
	  to write xfrdfile/difffile.
	
18 September 2006: Wouter
	- no queries for NSEC3, RRSIG, ANY succeed for nsec3 only domains.

15 September 2006: Wouter
	- Fixed LOC parsing of integer overflow causing maximum values.
	  Added to test and backported fix to 2.3.6.
	- NSEC3 qtype queries get noerror/nodata or nxdomain answers.
	  You can query for NSEC3PARAM.
	- warnings for printf format on maxOS (sizet needs cast to int).

13 September 2006: Wouter
	- added fsync to AF_UNIX sockets to write last command (QUIT) before
	  closing them.
	- sent explicit QUIT command to xfrd on final shutdown of the server.

12 September 2006: Wouter
	- Bug #144: LOC defaults for unspecified values wrong. Error in zonec.
	  Set defaults. Also fixed parser if LOC has no minutes or seconds.
	- Also fixed rounding error in seconds 0.001 decimal. 
	- Test tpkg for bug 144.

11 September 2006: Wouter
	- nsdc now more portable in use of 'which'.
	  Does not only look at exit code but also checks for '^no ' string.
	- nsd-patch does a chdir to zonesdir for relative difffile or dbfile
	  path names.
	- nsdc handles zonesdir: for relative pidfile, dbfile, difffile 
	  pathnames.

7 September 2006: Wouter
	- bumped version to 3.0.2.
	- Nice configuration error when you had the wrong zone name in the
	  nsd.conf file. Zonec will give an error already.
	- When you start a secondary zone without a zone file, you get
	  a much nicer error message, warning you of the zone transfer.
	- Credits for prerelease testers; Thanks guys!

6 September 2006: Wouter
	- Fixed nsd-patch so that it writes the SOA at the start of the file.
	- test tpkg that tests for the bug, has multiple rrsets at zone apex
	  and does nsd-patch followed by zonec.
	  Previous tests did not catch this: they used nsd-xfer to test zone
	  contents, or only checked the zone-file after nsd-patch.
	- version number bumped to 3.0.1.
	- svn tag 3_0_1 made.

5 September 2006: Wouter
	- differences file improvements.
	- created 3.0.0 release in svn tags.

4 September 2006: Wouter
	- From suggestions by Bin Zhang:
		- nsdc restart does not fail if nsd was not running.
		- fixes to man pages, wrong locations for files.
	- NSEC3-PARAM has no optout bit in presentation format.
	- NSEC3PARAM spelling.
	- differences in latex format (needs nlnetlabs housestyle).

31 August 2006: Wouter
	- Fix for tsig size still set when data is null ptr.
	- Fix configure for NetBSD (1.6 - 2.0) to find struct timespec.
	- DIFFERENCES file completion.

30 August 2006: Wouter
	- Print error nicely when nonblocking connect fails on systems
	  in a portable way.
	- doc/UPGRADING document to assist NSD 2 to 3 upgrades.
	- updates of error print - ignore EINPROGRESS if we check too early.
	- wait for select writable before testing for connect error.
	- echo "" >&2 is not as portable as we would like, removed from nsdc.
	- fixed debug print of a null ptr.
	- fixed bug where query for CNAME that points to unserved zone caused
	  nullptr exception on empty zone ptr. Now original zone is restored
	  after CNAME-pointed data is added to the packet.
	  Test in dname.tpkg. Reported by Kai.
	- fixed stack corruption when ipv6 disabled.

29 August 2006: Wouter
	- NSEC3 made it so it can handle the case where the NSEC3 RRSET
	  with the SOA bit on does not have the RR with the soa bit set
	  as the first RR.
	- Handle NSEC3-PARAM type. Checks to see if any of them work:
	  zone apex hashed exists, with NSEC3 type, and RR that has
	  the same parameters and the SOA bit set.
	- in presentation format of NSEC3, NSEC3-PARAM reversed hash, optout.
	- update to the DIFFERENCES file, bind 9.3.2 vs NSD 3 and 
	  NSD 2 and 3 comparisons are completed.

28 August 2006: Wouter
	- echo messages in nsdc made clearer. nsdc notify and nsdc update
	  only send notify messages to slaves / localhost to force transfers.
	- initial NSEC3-PARAM type code entry. parsed, ignored.

25 August 2006: Wouter
	- disabled make test target as tests are not shipped.
	- performed prerelease static snapshot.
	- updates to the DIFFERENCES document.

24 August 2006: Wouter
	- Fix bug 141 port from 2.3.6, copies behaviour from bind 9.3.2.
	- Added a test for bug 141.
	- Bug141: save the opcode from the query.

23 August 2006: Wouter
	- Fixed % by 0 exception in the bugfix #139.
	- Fixed RFC 4035 says CD flag SHOULD be cleared on authoritative
	  reponses, now NSD clears the CD flag. This is bug #140.
	  RFC 4035 could be confusing on this, as it states 'all servers
	  MUST copy the CD bit' more than once, but then makes clear only 
	  recursive servers are meant with that statement.
	- Differences document updates for bind 9.3.2 and nsd 3.

22 August 2006: Wouter
	- version number to 3.0.0 in preparation for release.
	- Bug #139: resync stats to whole period. Fixed.

21 August 2006: Wouter
	- check for error in ftruncate call.
	- replaced fwrite call with write_data call from util that does
	  error checking.

15 August 2006: Wouter
	- removed unused struct nsd.named8_stats variable.
	- Bug #138: nsd aborts trying to bind all interfaces if ip6 is not
	  enabled, instead it will fallback to ip4.

14 August 2006: Wouter
	- Added test for rollback of an IXFR transfer by xfrd.
	- Added test for reload timeout in xfrd, the reload does happen after
	  a while, but not immediately.
	- Test that makes xfrd connect to ip6 address.
	- Test that overloads the number of tcp connections in xfrd,
	  simulating a slow master, so that zones have to queue up to get it.
	- code coverage is now 2514 of 10636 uncovered. Still a lot uncovered.
	- ixfr queries return NOT_IMPL errors.

11 August 2006: Wouter
	- srandom to init random() in xfrd based on PID and time.
	- improved usage() information to be more helpful, and with version.
	- in makedist.sh, flex and bison called like in Makefile.
	- test for tcp underrun and overrun of the buffer.

10 August 2006: Wouter
	- added more tests to increase code coverage of testset.
	- moved acl parsing code from configparser.c to options.c to help
	  unit testing.
	- nsd-checkconf echod wrong difffile filename with -v.
	- nsd-patch can now be used with -f to force printing of all RRs.
	- TYPE_NULL crashed NSD when it printed it, arg was ZF_DNAME,
	  now ZF_UNKNOWN.
	- unknown rr test was faulty on input, the length was in nibbles
	  not in octets, but rfc specifies octets for unknown rrs.
	  NSD does not look at the length, and prints the length correctly.
	- added type NXT to the rr-test for weird RRs.
	- added printing test to rr-test, ipseckey and unknown-rr tests.
	  checks if NSD prints the same RR on output as it read in.
	- put -x option for nsd-patch in usage().
	- test that kills an nsd child server and checks that it is
	  restarted.

9 August 2006: Wouter
	- tested nsdc functionality, make install and make uninstall.
	- set O_NONBLOCKING on xfrd tcp sockets before the connect call,
	  because the handshaking can take very long too.
	- difffile and xfrdfile set via configure, to absolute pathnames,
	  so that chroot checks work for them.
	- updated tpkgs, they need to set relative paths now for diffile.
	- gcov says 2821 of 10617 total code lines are not covered.
	  compiled with --coverage, not -O2, ran tpkg/* and long/testplan*.
	  counted grep '#####:' *.gcov | wc and grep '^ *[0-9]*:' *.gcov | wc.
	- cleaned up the log functions, NSD no longer spams the syslog with
	  debug messages. The standard NSD debug util is used, -F -1 -L 2 for
	  a compile configured with --enable-checking will enable them again.
	  Errors are logged, as is the automated reload of a new serial.
	- tpkgs for bug077 and bug107 were silently failing to test properly.

8 August 2006: Wouter
	- fixes for checkconf test, more portable.
	- removed items from TODO that have been tested.
	  for multihomed servers you have to bind to each interface
	  explicitly to get outgoing ip-address the same as query
	  destination ip-address.
	  Forks and if-existing are tested and ok in testplan tests.
	  close_all_sockets is called by child, if tcponly, so leave it. 
	- user name check is hard portably with shell scripts, and 
	  packaging could set a default user that does not exist on a machine.
	- empty nodes (nonterminals) give no nxdomain any more (todo item done).
	- removed (old) from TODO.
	- removed contrib/buildzones.pl, it is outdated.

7 August 2006: Wouter
	- Made the tests a little more portable.
	- fixed mempcy unable to handle unaligned memory addresses on Solaris,
	  used memmove istead of memcpy in zonec LOC conversion code.
	- another unaligned memory access, when storing off_t pointer in 
	  difffile.c, used memmove.

4 August 2006: Wouter
	- nsd will start if diff file is corrupt, with a log message.
	  It ignores the bad data.
	- tpkg files do not override PATH, svnhook sets it. So user can
	  set path to utilities on the system to run the tests.
	- running testset on DecAlpha discovered uninitialised variable
	  in NSD. Fixed.
	- Jakob Schlyter asked for building nsd3 in an obj dir, i.e.
	  mkdir obj; cd obj; ../configure && make. Fixed up makefile for that.
	- and bug137.tpkg for separate obj dir building.

3 August 2006: Wouter
	- more tests in mesh test.
	- changed test packages to put nsd log to test result "/dev/stdout".
	- test packages more portable - use default 'dig' location.
	  also, path is appended to, instead of replaced.

2 August 2006: Wouter
	- Region can be customised for detailed memory handling.
	  Especially if you set large_object_size=0, chunk_size=0,
	  the region will perform individual allocs, and 'save memory'.
	  The region still keeps tracks of allocations so that at
	  region_free time all memory is released.
	- tsig.region removed, it was not used after attaching a cleanup
	  at creation. tsig creation uses custom region settings.
	- xfrd inits the tsig records with memory saving settings,
	  so the regions alloced for tsig take up about 60 + 4*8 bytes.
	- new custom region for query region - to make chunksize larger
	  there. The chunksize for the query region is important, if
	  all allocations for a query fit in it, no mallocs are needed.
	- TSIG other_data field size according to RFC 2845 is 0 or 6.
	  In tsig implementation put a maximum to the field of 16,
	  otherwise a formerror results.
	- query with IXFR appended SOA not formerror.
	  IXFR queries not reach the handler in axfr.c for IXFR queries.
	- removed annoying debug message of added tsig key.
	- added test that starts 7 servers in a mesh and lets them fight out
	  what zones to transfer and serve.
	- xfrd logic bug: if notified a slave would not see the renewal
	  of its current zone.

1 August 2006: Wouter
	- Test for remove domains with IXFR.
	- Fix for empty nonterminals and IXFR deletes.
	- Test for timeouts, including expiry, and expiry and zone updates.
	- Test for axfr refused authorisation.
	- Test for deadlock in ipc.

31 July 2006: Wouter
	- Test plan ixfr test in tpkg/long directory.
	- IXFR with many packets tested (one RR per packet).

28 July 2006: Wouter
	- tentative change, that preserves ordering of rrtypes for a domain.
	- fix for serial rollover (old_serial + 2**31), now works, is seen
	  as new serial and rolled over to new.
	- serial numbers, and time values, printed as unsigned to logfile.
	- set so that if info is provided by operator, refreshing state
	  not expired is used.
	- forgot to * a pointer to boolean, is_ixfr in the difffile reader.
	  This fixes the testplan_ixfr test 1.

27 July 2006: Wouter
	- fixup desc of tsig xfer test, remove debug from xfr_huge.
	- fixed compressed dname tables cleanup, to set ptr to NULL.
	- initialised xfrd_listener.fd to -1.
	- fixed difffile handling of very short AXFRs, with no data.

26 July 2006: Wouter
	- Updated the requirements with comments from Olaf.
	- README discourages use of experimental nsec3 rr a bit more.
	- typo in DNAME code, used original qname instead of CNAME
	  adapted qname variable.
	- added IPSECKEY RR type, RFC 4025.
	- tpkg test with sample ipseckey rrs.
	- wireformat for IPSECKEY depends on the value of a rdata atom, added
	  WF_IPSECGATEWAY to handle that.
	- DHCID type, data is encoded in one binary/b64 blob.

25 July 2006: Wouter
	- max number of tries for nsd-notify is 15, so that the
	  total time for sending is about 75 seconds.
	- forward port of fixes for bug 105 and 135 in nsdc.
	  forward port of test for bug 105.
	- fixed nasty bug with configure --prefix=<...> where config.h
	  was wrong. Now double evaluate the shell expansion on the defines.

5 July 2006: Wouter
	- helped in README with gnu make; need to make clean
	  so that botched attempts by make to create the lexer files
	  do not stay around.
	- removed %zd, replaced by casts to int.
	- updated REQUIREMENTS file, the sections on RR types, on what
	  algorithm NSD follows and on which RFCs are supported are updated.

3 July 2006: Wouter
	- 'make depend' target in makefile. (updates both Makefile.in
	  and Makefile, so it works for users and for svn).
	- doc minor update.

2 July 2006: Wouter
	- TESTPLAN, README, bugzilla-bugs docs updated.
	- NSD for BIND users update.

29 June 2006: Wouter
	- removed --zonesfile nsd.zones configure option.
	- doc/README updated for 3.0.
	- doc update. NSD_FOR_BIND_USERS document.
	- moved from -Ds to the config.h header, cleaner compilation output.
	- use autoconfs built in large file support enabler.

28 June 2006: Wouter
	- nsdc neater, checks for BLOCKED ips more strictly.
	- nsd -d also disables xfrd forking, and thus all reloads
	  and secondary zone treatment. Stated so in manual page.
	- fixup, apart from ip4 need to allow ip6 in example.conf
	  line showing how to allow access for everyone to axfr.

27 June 2006: Wouter
	- Fixed read in server.c to be a blocking read for sure,
	  even if ipc is not blocking on the OS.
	- nsd-notify tries to send notify 5 times, then exits with error.
	- nsd-checkconf can lookup key secrets by name from a config file.
	- difffile option is always set in options struct with default
	  or config value.
	- nsd-patch uses dnames to compare zone names (for trailing .).
	- nsdc updated to work with config file.

26 June 2006: Wouter
	- Nicer check in autoconf for struct timespec type.
	- NSEC3 next hashed ownername is a length byte followed by data.
	- nsd-checkconf more quiet, clearer error message.
	- NSEC3 does not complain about glue records without nsec3.
	- nsdc work (did start, stop, running, rebuild, restart, reload, stats).

21 June 2006: Wouter
	- nsid commandline parsed using hex_pton routine.
	- unit test for hex_pton.
	- added include stdlib, needed for free() on sunos4.
	- fixup of disable-ipv6 compilation.
	- memmove compat implementation (created fresh).
	- yy_set_bol() for old flex compat define.
	- compat implementation from openssh4.3p2 for
	  strlcpy, inet_aton, and inet_ntop routines.
	- changed ctime_r usage to ctime() call, nsd is not threaded.
	- compiles on SunOS4/gcc-2.95.
	- debug statements go to the log_msg route instead of the
	  fprintf route, so they will get to a nice logfile even if
	  we forked away, with xfrd. logfile=/dev/stderr gives old way.
	- minor changes to cutest to make unit test compile
	  on SunOS4/gcc-2.95, it checks out fine there.

20 June 2006: Wouter
	- updated configure to disable -O2 on platforms where gcc 
	  does not like it (such as dec-alpha).
	- nsd-notify used recvfrom and passed addrinfo.ai_addrlen
	  which is a size_t, but recfrom needs a socklen_t*. On dec
	  alpha these types differ in size (size_t is 64bit, 
	  socklen_t is 32bit). Therefore, used a wrapper variable
	  to pass to recvfrom.
	- changed long int to time_t in nsd-patch.c to please compiler
	  on dec alpha.
	- dec alpha complains if statements are in front of variable
	  definitions. Fixed code for some mixups on this.
	- Fixup cutest for dec alpha. Code, lowercase filename, %lf->%f.
	- cutest fixup uses (size_t) cast and %zx to print ptrs (for debug).
	- for SunOS4 configure detects ssize_t and struct timespec.
	- removed usage of fpos_t, instead using fseeko/ftello for 64bit.
	- configure will define fseeko/ftello with fseek/ftell if unavailable.
	- added missing include from buffer.c (stdlib for free()).
	- defines for snprintf and vsnprintf in config.h if needed.
	- configlexer flex is called more cleanly with -t to write stdout.
	- missing include from configparser, stdlib for atoi.
	- config.h provide inet_pton define if it is not available.
	- fixup of INET6 defines, where sockaddr_storage is used
	  outside of INET6 defines, in xfrd-tcp.
	- edns_init_nsid was not defined in edns.h.
	- added compat/fake-rfc2553.c and h from openssh 4.3p2. That has
	  a BSD license as well. They replace getaddrinfo() (and friends)
	  when those are missing.

19 June 2006: Wouter
	- updated the tpkg/manual tests for NSD 3 config files.
	  Some need root privileges to run (using hping), they all pass.
	- also the tpkg/long test bug_sighup.
	- nsec3 code will warn at prehash time for missing exact nsec3
	  records. So faulty signed zones are more easily spotted.
	- fixed NSEC3 and CNAME/DNAME chains, it will disprove the new qname.
	- removed for() look in CNAME processing, only first CNAME is
	  processed now.
	- zonec will error on a zone with multiple CNAMEs for one name.

16 June 2006: Wouter
	- Swapped read and write ops in xfrd_handle_ipc, so that a read
	  of a signal from main can stop further writes.
	- xfrd will complete its last message before shutting down
	  the ipc writes and then acknowledge the reload-sync.
	  This resolves the race where half of ipc messages caused bad
	  modes from the main.

15 June 2006: Wouter
	- In preparation of notify send overhaul, moved the notify
	  send code to xfrd-notify.c and h files.
	- created cleaner split of notify send and xfr code.
	  Still in the xfr process, because it is a convenient location.
	- fixed bug where notify sending would read from wrong fd.
	- send master zone notifies.
	  Does not skips master zone SOA INFO updates.
	- fixed bug where port number acls did not match.
	- fixed bug where tsig keys are checked for twice, but not error_code.
	- fixed notify send retry counting.
	- added test tpkg for notifies from nsd master to nsd slave.
	- nsd-checkconf flags if you set allow-notify without request-xfr.

14 June 2006: Wouter
	- fixed crash bug when dnssec/NSEC enabled and query DNAME
	  target did not exist.

13 June 2006: Wouter
	- created doc subdirectory for documentation.
	- removed unused DIFF FILE MAGIC string.

12 June 2006: Wouter
	- dname_test tpkg with very extensive DNAME testing.
	- moved sizes of zone_name buffers to 3072 - for escaped names.
	- nsd-patch has a debug option to list the contents of the 
	  difffile/ixfr.db/transfer patch log in a journal fashion. You can
	  then manually inspect the contents.

9 June 2006: Wouter
	- after a reload NSD will report the memory churn: number of bytes
	  of memory wasted by the zone transfer code.

8 June 2006: Wouter
	- When zone is re-chosen after a CNAME/DNAME no SERVFAIL is set,
	  noerror is returned instead.
	- zonec will error on multiple DNAMEs for the same name.
	- zonec will error on DNAME and CNAME together.
	- improved loop log message.

7 June 2006: Wouter
	- after DNAME the closest_match is set correctly for another DNAME.
	- in case of a loop returns gracefully instead of crash.
	- nsec3 checks if it is enabled for the zone for wildcards.
	- NSD will give referrals for zone cuts encountered after a CNAME
	  or a DNAME. This also fixed various subtle stuff with CNAME/DNAME
	  and TYPE_DS at zone cuts. It basically re-determines the zone
	  to use after the CNAME/DNAME.

6 June 2066: Wouter
	- zonec checks for data below a DNAME, and will not create the db,
	  as per rfc 2672. Tpkg test to make sure such a zone is not loaded.
	- updated rr-test tpkg so it has no data below a DNAME.
	- DNAME synthesis of CNAME records, including compression for cname.
	- included cname creation in dname test.
	- preallocate the extra temporary domain_type structures.
	- too many temp domains returns OK packet so that the resolver 
	  will recurse and ask us again with the last name in the chain.
	- fixed bug introduced in preallocation on temp domain numbering.

2 June 2006: Wouter
	- dname_replace function that does DNAME replace and unit tests.
	- added error codes from DNSUPD rfc2136 to constants in dns.h.
	- in query.c added DNAME following code.
	- fixed bug 134: hints[i] in nsd.c to hints[0].
	- added tpkg small test for DNAME.
	- tpkg to test bug 134 (starts 100 processes).

1 June 2006: Wouter
	- tsig test with NSD master and NSD slave server. Tsig AXFR transfer.
	  nsd-xfer used to test slave zone contents.
	- fixed bug where buffer_flip() is done before appending tsig rr.
	- version printed at start of nsd in logfile.
	- xfrd prints name of tsig key used during transfer in commit comments
	  so it appears in the log file and in zonefile after nsd-patch.
	- prints RRs from diff file only if debug level >= 1.
	- scalable transfer test xfr_gig added, you can set the size to try
	  in the .pre file. Now set very small.

31 May 2006: Wouter
	- xfrd check for failed updates. It compares the time it wrote the
	  commit to disk with the time of the last reload command.
	  Failed updates are restarted like the zone is notified of the soa.
	  It also catches reloads that have been lost (reload cmd while reload
	  is running, or a crashed reload process, for example).
	- when reload is issued, times at that second are put back one second,
	  so that after a reload all the zones that should have been loaded
	  have a time from before the reload. 
	- if a reload crashes, NSD will continue with the old database,
	  xfrd is not informed, since it cannot fix that. 
	- nsd-checkconf strdups arg strings before writing to it.
	- tsig error replies contain error data, but no signature.
	  also crashproof, badly formatted tsigs get a format error.
	- tsig error print knows about DNS rcodes in tsig error field.
	- added tpkg tests for tsig.
	- tpkg test for nsd-xfer with TSIG from nsd.
	- small stuff with makedist.sh, CREDITS, Features, make test.

30 May 2006: Wouter
	- tsig pre-allocs the rr_region, not at runtime, tsig_create_record().
	- redid some region work for tsig. Now has another temporary region
	  for the context data. User is only aware of the region passed at 
	  start that exists for the lifetime of the struct.
	  During TSIG checks no more mallocs are done, only region_free_all
	  and region allocs (of small size).
	- checkconf, port is stored as a string.
	- tsig now keeps a max_digest_size for giving reserved space.
	- AXFR does tsig every 96 packets (and first and last packet).
	- tsig signing works for all queries. SOA queries, ...
	  If you configured the key in the config file, you can use
	  that key for any query for any zone.
	  Except for NOTIFY and AXFR queries; those are only allowed for
	  the zone (and source ip address) which are configured in the config.
	- cleaner compile with tsig disabled.
	- fixed unknown key error reply in tsig.

29 May 2006: Wouter
	- The nonblocking write routines disable silently if they have
	  nothing to do.
	- put xfrd read/write state routines (almost 500 lines of code)
	  into xfrd-disk.c file.
	- little readme blurb on xfrd state file for the operator.
	- put ipc code in its own file for ease of reading.
	- removed --disable-axfr, you can control this via acls.
	  With no provide-xfr: statements, a zone will not do axfr.

25 May 2006: Wouter
	- fixed reload sending; it checks for EAGAIN and EINTR.
	- reload sends parent quit command blocking to make sure of arrival.
	- send_children_quit in parent uses nonblocking writes and closes
	  the pipe to signal the child to quit (even if the write does not
	  come through, the closed pipe will cause the child to quit).
	- need_to_send_STATS flag in parent. 
	- reload has its own ipc-listening handler in server_main.
	- nonblocking writes for server_main; this solved write-blocking race.
	- another race condition solved, if a process dies, half a read or
	  write buffer could be left behind on another process. These are
	  dropped. Now:
	  	* The server_main drops ipc from dead children.
		* The server_main drops ipc if xfrd dies.
		* The server_main drops xfrd(old) and all children ipc 
			on reload.
		* The xfrd drops ipc to parent on a SOA_BEGIN from reload.
		  So after reload, but parent and xfrd start with 
		  clean ipc buffers.

24 May 2006: Wouter
	- unit tests print progress while running to stderr. Included license
	  of cutest with its source in svn repository.
	- stack type (for the IPC buffer of zone update dirty). And unit test.
	- only update zone-is_ok if needed to reduce memory copy on write.
	- split off conn_write() from xfrd tcp nonblocking write routines.
	- nonblocking writes for xfrd.

22 May 2006: Wouter
	- ported over minor nits from 2.3.5 NSD fixups. Cast to (void) 
	  unused function return values.
	- removed kill signal to children, superfluous due to quit cmd ipc.
	- moved is_ok for zones to the zone_type in namedb, not in 
	  the options, it is a runtime value not a config value.
	  For zones that have no data, parent and children keep no state.

12 May 2006: Wouter
	- fixed up usage print for zonec to include -f option.
	- xfrd send notifies.
	- server no longer sends SOA INFO for master zones.
	- removed possible debug log print of a null string.

11 May 2006: Wouter
	- nsd.conf.sample shows defaults for ip4-only, ip6-only and debug-mode.
	- SOA_BEGIN message on start of reload sending soa info so that
	  xfrd will not reply with expire-notifications and thus deadlock
	  both on blocking writes (and no OS buffer on the pipes).

10 May 2006: Wouter
	- nsdc.sh is set +x after creation.
	- improved error message when zone in db has no config info.
	- support for broken nsec3 chains (if the one with the SOA bit
	  is complete, it is OK for there to be other nsec3 chains 
	  with different parameters in the zone).

9 May 2006: Wouter
	- Fix for finding bad zone when populating SOA info on start.
	 it would find a parent zone instead of the zone in question (
	 which is empty).
	- request-xfr: AXFR 10.0.0.153 keytouse syntax to interoperate
	  with NSD machines. Will only send AXFR queries to the machine.
	- documented AXFR option in nsd.conf.5 manual page,
	  and updated nsd-checkconf, nsd.conf.sample.
	- made 'skipping zone' log entry clearer (Sam Weiler asked).

8 May 2006: Wouter
	- updated zparser.y to handle empty nsec_seq lists.
	  for empty nonterminals in NSEC3.
	- nicer without ambiguous grammer.

5 May 2006: Wouter
	- nsd-notify handles option -y key:secret to TSIG sign outgoing
	  queries.
	- the acl checks now verify TSIG signatures on the query.
	- iterated_hash compiles with ssl disabled.
	- new ipc NSD_ZONE_STATE sent by xfrd to nsd process. notifies
	  nsd of the state (ok or expired) of a zone.
	- reload process waits for the old server_main to exit to make
	  sure there is no race condition listening to the NSD_ZONE_STATE
	  messages generated when reload sends SOA_INFO to xfrd.
	- server_main and children all set zone_ok state in config options.
	  also server_main so that newly forked children get the right state.
	- if a secondary zone is expired, NSD returns SERVFAIL.
	  a transient error, so resolvers try again later.
	- SOA_END ipc message, sent by reload to xfrd, so it can repeat
	  all zone states (which can have changed during reload).
	- zone_is_ok kept in config section so that state for zones
	  without data is not lost. Those have no zone_type*.
	- secondary zones start in the expired state.
	- if expired zones are updated, then NSD gets the go ahead from
	  xfrd after reload sends SOAINFO/SOAEND msg, so it is really
	  updated in nsd memory.
	- fixed tpkg xfr_1 to have longer expiry times (from 0 and 3
	  seconds to 2000 and 3000 seconds), so the zone does not expire
	  during the test anymore.

4 May 2006: Wouter
	- when a new lease is acquired xfrd_packet_newlease result is used.
	- if a zone is lost in nsd db, xfrd will update state to match.
	- IXFR can use TSIG in queries and verify responses.
	- Fixed memory leak in xfrd tsig handling.

3 May 2006: Wouter
	- forward of 2.3.4 RELNOTES into trunk.
	- debug log statements to track xfrd request rounds.
	- removed memleak from handle_passed_packet in xfrd.
	- faster find_zone in difffile.c.
	- nsd-patch writes commit log entries into zone file.
	- took some tsig.c enhancements from 3 branch,
	  -> if key or algo changes during connection, return bad_key,
	  -> debug statement neater.
	- nsd adds tsig keys to tsig keyring at startup.

2 May 2006: Wouter
	- ifdef inet6 back on ss_family usage in server.c.
	- nsd-checkconf ip6 ifdefs improved.
	- xfrd tries servers 3 rounds, then waits for next retry.

1 May 2006: Wouter
	- off_t used for 64bit fileio. 
	- searches for smallest unused part and sets diff_skip to that.
	- doc comment near the region_free_all for every query about 
	  malloc speed.
	- null ptr in strcmp does not work on bsd, fixed nsd-checkconf.
	- made nsd.conf.sample.in so the sample gets prefix-corrected.
	- removed nsd.zones.sample.
	- makedist.sh added manual pages for nsd-xfer nsd-patch.
	- install/uninstall nsd-patch, nsd-checkconf and manpage. 
	  small update readme.

28 Apr 2006: Wouter
	- ixfr >64k in xfrd.
	- fixed length of new commit parts.
	- fixed multiple ipc reads in xfrd.
	- fixed multiple packet ixfr read in diff file.
   Miek:
	- Forward port fixes for nsd-xfer and nsd-notify

27 Apr 2006: 
   Wouter:
	- nsec3 review fixes.
	- diff file format expanded for >64kb transfer support.
	- diff reader adjusted for >64kb.
   Jelte:
	- small non-null options check in nsd.c.
   Miek:
	- updated nsd-checkconf for zone parse shell script support.

25 Apr 2006: Wouter
	- Tests on NSEC3 code. Fixed that the unsecure delegations also
	  have _ds_ parent nsec3 prehashes, so that they get proper NSEC3s.
	  NSD will serve NSEC3s to prove 'opt-out' also if the opt-out bit
	  is (erroneously) not set.
	- For the 05pre2 draft section 5.4.8.1. QTYPE is NSEC3, only NSEC3
	  RRsets at name. Fixed that RRSIGs present do not matter.
	  And also the closest encloser proof in that case fixed.
	  If wildcard exists below zone apex servfails (cannot disprove
	  it and NSD cannot instantiate the wildcard at that point).

24 Apr 2006: Miek
   Miek:
	- forward port nsid (disabled by default)
   Wouter:
	- nsd-patch manual page.
	- minor MacOSX port fixes.
	- xfrd-reload-timeout: config option.
	- if you set the xfrd reload timeout to -1 it will not
	  automatically reload after a transfer. User can reload.
	- reload timeout is a wait period after the reload is triggered.
	- more verbose acl logging. Validated acls are logged in detail.
	  Invalid acls are only logged in debug mode, level >= 1.
	- log message when xfrd tcp connections max out.
	- if unknown NSEC3 hash type (not SHA-1), disable NSEC3.
	- xfrd randomizes the timeouts, within 10% of original,
	  to spread out activity. Short timeouts < 10 seconds are not
	  affected, and will give activity bursts (on startup for example).

21 Apr 2006: Wouter
	- put NSEC3 code in nsec3.c and nsec3.h.
	- iterated_hash only adds the salt if salt_len > 0.
	- added some assertions and cleanups to nsec3 code.
	- prehash also calcs the nsec3_last domain*.
	- dbaccess when reading in will set the rr_type.owner value.
	- changed namedb_find_zone to domain_find_zone, log msgs.
	- implemented logic from nsec draft 05-pre2 section 5.4.1 - 5.4.8.
	  NSEC3 responses only happen for nsd compiled with --enable-nsec3
	  and for zones where an NSEC3 with the SOA bit set exists.
	- added prehash pointer to ds parent side cover for opt out.
	- removed dynamic plugins. Dynamic plugin support is an explicit 
	  non-requirement (under creeping featurism).
	- in domain table create root nsec3 ptrs are NULL.

20 Apr 2006: Wouter
	- Unittest of base 32 encoding. 
	- unittest start for iterated hash.
	- fixed for ctrlc in debug mode.
	- delete zparser_conv_long, not used, not needed
	- nsd-xfer will display NSEC3 correctly. zonec parses.
	- improved usage() line from zonec, about -c none, must be -C.
	- base32 printed in lowercase (canonical format for DNS).
	- NSEC3 added prehash pointers to the namedb.
	- NSEC3 autodetects presence of NSEC3 in zone and parameters.

19 Apr 2006: Wouter
	- port fix base10 in zonec conv short from 2_2 branch to trunk.
	  and conv byte, algo, certificate, long.
	- configure option to enable NSEC3 (--enable-nsec3) support.
	- from Ben Laurie's NSEC3 patch, loaned the parse code,
	  base32 conversion code and iterated_hash. 
	  With some small modifications. The type rrdescriptors are 
	  indexed by value below SPF, and in 
	  rdata_wireformat_to_rdata_atoms BINARYWITHLENGTH checks
	  for end of buffer. Also parser checks for '-' salt.
	  Some layout (spaces after ,s). And NSEC3 define is used.
	  strtol used for iterations is base 10.
	- moved rrtype descriptor table sanity check to unittest.

18 Apr 2006: Wouter
	- Fixed check for SOA IN, bad ntohs in the check.
	- minimum timeout also enforced for very low expire times.
	- report the actual used length of the sockaddr to sento
	  for FreeBSD.

7 Apr 2006: Wouter
	- modified the kill_nsd tpkg so that it waits up to 10x5 secs
	  for nsd to make the pid file, and it wait up to 10x5 secs for
	  nsd to exit after the kill signal is given.
	- xfrd checks on startup if there is trailing garbage in the
	  diff file, left there by a previous xfrd killed in action.
	  It then snips off any partial parts, so service can resume.
	  Also the difffile_skip pos is set before any partial record there.
	- first version of nsd-patch; reads db and ixfrs and updates zones.
	- moved print_rdata from nsd-xfer to rdata.h to share code.
	- moved print_rr from nsd-xfer to util.h to share code.

6 Apr 2006: Wouter
	- notify handler passes acl number that matches to xfrd.
	- xfrd keeps a next_master for a zone, and sets it after notify.
	  when notified nsd will try to contact the master that sent
	  the notify, if send from an address that is both in acl
	  allow-notify and request-xfr.
	- xfrd closes its tcp and udp sockets on exit.
	- default names for diff file and xfrd state nicer.
	- fixed up kill nsd grep on ps.
	- fixed up race conditions in test script for kill nsd
	  wait for pid file creation by nsd, and grep -v grep in check.
	- in nsd signal-flags inherited from the parent are zeroed 
	  when a server_child starts. Also the server_child switches back
	  to NSD_RUN mode when a bad mode happens.
	- check if ixfrs start from the version in memory.
	- if IXFR/AXFR ends in a serial that is newer than the serial
	  that was sent in an notify, update the notified serial.

5 Apr 2006: Wouter
	- added lowerbound for retry timeout.
	- added extra assertions to xfrd-tcp.c, saying that the waiting line
	  for tcp connections must be empty if the counter is below max.
	- setup so that the first master tried is the first in acl list.
	- diff file skips OPT and TSIG RRs if they are put into the answer
	  section.
	- if IXFR contains an RR to delete that does not exist, nothing
	  happens.
	- update zone for NS, RRSIG also if multiple RRs in the rrset.
	- difffile: create zone struct also if domain exists already.
	- difffile: destroy temp region on error.
	- difffile: in delete_RR, create temp region outside of the routine,
	  so no alloc region, destroy region for every deleted RR.
	- difffile: for IXFR: do not delete final SOA RR.
	- difffile: unknown parts in file is an error.
	- difffile: EOF on last packet is ignored w/o giving an error.

4 Apr 2006: Wouter
	- Addes EACCES to the netio dispatch error bailout.
	- Removed EACCESS (probably due to log_msg), error on close
	  xfrd pipe is small, main process closes its end, and hopes for 
	  the best).
	- review: return on error condition in xfrd_tcp_open fixed.
	- review: expired when time >= expire_time, so it will not wait
	  for the retry after expire until it will detect the expiredness.
	- removed duplicate lines from xfrd_handle_zone_timeout.
	- review: copy of uint32_t using memcpy to avoid unaligned memory
	  accesses.
	- review: fd=-1 removed from set_refresh_now; only does timer.
	- on a tcp timeout it will retry immediately (instead of waiting
	  another retry timeout). This means if you set refresh_now, it will
	  interrupt a tcp-timer for a fresh retry with the next master.
	- put null in buffer for xfrd read state.
	- log msg uses string that exists instead of overwritten buffer.
	- read entry sets refresh depending on current time,
	  and makes sure not to check soa contents if none provided.
	  added explanatory comments.
	- EACCES back in check.
	- server_main first checks for terminated children, then select().
	  So when select is interrupted, by kill or quitting children,
	  it will first see if it has to quit itself, before restarting
	  the children.
	- destroy tempregion xfrd read on error.
	- check for serial existance in xfrd_handle_incoming_soa.
	- handle_incoming_soa uses set_timer_refresh routine.
	  and can handle expire times < refresh times.
	- log msg for udp socket() error.
	- review: xfrd_parse_soa_info email parse uses correct buffer spot.
	- added a lowerbound to refresh interval (=1 second now).
	- upon receipt of a IXFR, if the serial is older than the notified
	  serial, the zone stays refreshing (but the ixfr is saved).

3 Apr 2006: Wouter
	- Added buffer length check to internal ipc.
	- split out packet_read_query_section from the process_query_section
	  routine (and moved to packet.c/h).
	- xfrd reads passed packet via ipc.
	- ported over fix to 2_2 on missing rr types by removing the 
	  duplicate RRtype array, and using rrtype_to_string.
	- xfrd handles notifies. immediately starts updating.
	- xfrd state file format fix.
	- removed libwrap stuff - superseded by acls.
	  use provide-xfr: statements for your zone in the config file.
	  updated README for this.
	- updated tpkg tests for axfr to use provide-xfr: 127.0.0.1 NOKEY
	- review: move var create to start of function (xfrd_init()).

31 Mar 2006: Wouter
	- zone type has a pointer to zone options.
	- nsd options has an rbtree to find zone options in.
	- nsd checks acl for incoming notifies and replies
	  error or confirmation.
	- nicer layout in options.c.
	- updated makefile dependencies.
	- fixed sz for SOA_INFO ipc, which was too small.
	- notify is sent to server_main, server_main sends it to xfrd.

30 Mar 2006: Wouter
	- include: documented in manual page.
	- MAXINCLUDES define in one place (config.h).
	- configure checks for strptime in include files.
	- use %d instead of %zd (sparc5 machine does not get zd).
	- use region_strdup in configlexer.
	- added a check for EINVAL in dispatch - will abort
	  on the error instead of busy hang.

29 Mar 2006: Wouter
	- \r for config lexer. (similar changes to zonelexer).
	- forward port of fix to 2_2 branch:
	  short int in var_arg is promoted to int, according to B. Laurie.
	  The same logic for %o, %d %x would hold for %u I think.
	- in XFRD, soa prim_ns and email domain names are kept in a max
	  size buffer.
	- split up dname_parse into parse from string to wireformat
	  and parse from wireformat to memoryformat, so both can be called.
	- split up dname_make_from_packet into reading the wireformat
	  from the packet and the dname_make, so both can be called.
	- xfrd reads all soa info from incoming xfr packets.
	- xfrd will ignore TC bit on tcp channels.
	- nsd sends xfrd all soa info, including ttl and dnames.
	- config file now has an include: filename directive.

28 Mar 2006: Miek
	- forward port fixes for zone compiler and \r. svn:1926-1927
	- add DO bit MASK and remove the !! construct

17 Mar 2006: Wouter
	- according to axfr-clarify, added comments that we check
	  more leniently on further responses on a TCP stream.

16 Mar 2006: Wouter
	- Fixed up SOA INFO Send routines. Send from server works.
	- niced up xfrd state file.
	- Fixed up so that after a reload it will continue in diff file
	  where it left off.
	- made send of SOA info use write_socket, in case of short writes.
	- redesigned xfrd_tcp_read to use the same code for ipc read.
	- no free()s before xfrd exit.
	- xfrd handles incoming SOA INFO ipc packets.
	- removed debug, updated zones get SOA INFO sent.

15 Mar 2006: Wouter
	- Fixed up domain table insert, it was being used in routines
	  that originate from nsd-xfer that do not set compression numbers
	  correctly.
	- memleak fix in diffile in case of error.
	- difffile processing works so that NSD can read an axfr saved
	  into the nsd.diff file. (xfrd already request and save it there).
	- split off xfrd tcp handling into xfrd-tcp.c.
	- cleaned up send_udp in xfrd, and read_state.
	- removed xfrd tcp_send_blocking.
	- xfrd sets state from ok to refresh to expired based on timeout.
	- xfrd sets reload timeout.
	- Added zone updated to keep track of zones that are changed
	  after a reload. These zones get their information notifified
	  to xfrd.
	- removed unused zprintrr declaration from zonec.h
	- nsd sends soa information to xfrd.

14 Mar 2006: Wouter
	- TODO updated
	- worked on reload ixfr. It will add/delete RRs and zones.
	- xfrd receive parse of xfr messages improved. writes commit.
	- server compressed_dname_offsets table is increased if reload
	  creates extra names.
	- difffile will create zone and apex if not there (i.e. the zone
	  is configured but no data file provided).
	- bit more verbose in error message for bad diff file.
	- Typo fix in sample config file.

13 Mar 2006: Wouter
	- configure sets fseek (fgetpos/fsetpos) to use 64 bit interface
	  with _FILE_OFFSET_BITS=64.
	- nsd will skip loading the .db if the DB checksum is the same.
	- Miek added trace test and nsd kill test.
	- Wouter worked on diff file c.

10 Mar 2006: Wouter
	- Cleanup of UDP/TCP code in XFRD.
	- xfrd now has tcp max connections and managing. tcp read/write.
	- response TC on UDP ixfr, starts TCP.
	- sends correct ixfr and axfr queries, a bind server answers.
	- made packet_skip_dname() public.
	- sets read/write event flags for tcp fd right.

9 Mar 2006: Wouter
	- Removed header from DIFF file format. CRC not that imporant there,
	  you have to check the packets anyway.
	- cutest rbtree removed unused clean_rbtree and always_fail routines.
	- xfrd timeout handler, more work. Checks expire.

8 Mar 2006: Wouter
	- xfrd sends UDP xfr request to master(s) with timeouts, and stores
	  returned data on disk.
	- updated dependencies and declaration of write_soa_buffer.

7 Mar 2006: Wouter
	- Fixed printfs for size_t warnings on Mac OsX.

6 Mar 2006: nsd-team
   * Wouter: xfrd read and write work. Statefile is "nsd.xfst".
   * Wouter: nsd-checkconf checks dname parse of zone name:.
   * Wouter: updated difffile in parser.y, production in server: clause.
   * Wouter: zonec now takes -C for 'no config file' option.
   * Wouter: updated configyyrename.h for bison 1.875d on sparc.
   * Miek: zonec -h and nsd -h exit with exit code = 0.
   * Miek & Wouter: updated tpkgs to work again.
   * Wouter: xfrd read handle soas, handle soa_incoming part.
   * Wouter: moved compare_serial() from nsd-xfer to util.h.

4 Mar 2006: Wouter
	- xfrd zone and soa memory structure definitions.
	- xfrd init zones.
	- xfrd read and write state file code.
	- option for difffile: and xfrdfile: config lines.

3 Mar 2006: Wouter
	- Removed double kill after reload. Only socket cmd send.
	- Added code to handle race condition where xfrd is restarted
	  during a succesfull reload. Afterwards, the new server_main
	  only has the old xfrd pid, new xfrd is an orphan.
	  Solution: when xfrd closes cmd channel (i.e. it quit)
	  unexpectedly, send sighup to all processes in the group.
	  This should quit the orphan & all children & reload the
	  server_main, which will fork the children and xfrd again.

2 Mar 2006: Wouter
	- Added nsd-checkconf.8 to makedist.sh replace list.
	- DIFF file format updated.
	- removed tsigkey->server value, it was read in, but unused.
	- new function to add config file keys to tsig.
	- nsd-checkconf checks parsing of keys. 
	- Updated sample key file with valid keys.
	- added first xfrd files. xfrd is started from server_main.
	  xfrd listens to server and server to xfrd. xfrd is restarted
	  if it dies unexpectedly. xfrd quits when server signals it.
	  xfrd survives nsd reloads.
	- nsd_options no longer global variable.

1 Mar 2006: Wouter
	- Nicer text in nsd.8.
	- nsd.c prettier code in option handling.
	- zonec.c code prettier in option handling, also chdir bug removed.
	  zonec uses the zone definitions in the config file.
	  updated zonec.8 and usage().
	- nsd also chdirs to the zonedir, otherwise nsd and zonec would
	  try to read the database: file from different directories.
	  .(it does the chdir before the chroot call.)
	- new calling syntax for zonec and nsd, because of new config file.
	- options added acl acceptance tests (no tsig yet).
	- added unit test for options.c - for acl tests.
	- zonec removed unused vars, nsd-checkconf print arguments.
	- nsd-checkconf.8 manual page.

28 Feb 2006: Wouter
	- checked in options.h and config parser code.
	- also nsd-checkconf that will test a config file 
	  .(and optionally show what was read).
	- default identity has a spelling error.
	- Small fix (typo in example) to config manual page.
	- Added ; to configparser.y to please bison 1.75 on bsd.
	- Will check for blocked addresses in outgoing acls. Also ranges.
	- Check configuration tpkg test added. Uses checkconf.
	- checkconf does extra semantic tests. i.e. enable absent features.
	- tcpcount and servercount cannot be negative.
	- updated nsd.conf.5 manpage for @port syntax.
	- changed config parser: allows empty server: part (defaults).
	- made nsd.conf.sample file.
	- put option to configure for CONFIG_FILE nsd.conf location.
	  Note. Already nsdc.conf exists. Both exist now.
	- updated makefile dependencies (gcc -MM).
	- getopt optstring in nsd-checkconf updated ("v" only option).
	- Added config .o files to nsd and zonec. This compiles.
	- Added commandline option -c configfile to zonec and nsd.
	  configure defaults < configfile < commandline options in importance.

24 Feb 2006: Wouter
	- Added compute_crc in util.h and unit tests for it.
	- in cutest.tpkg the number of unit tests was hardcoded
	  in the tpkg package. Removed the dependency, cutest exit
	  value indicates if any failures happened.
	- Added crc at end of NSD-database format. Unique per db.
	  upped db version to 7 because of this.
	- Tested that crcs are big/little endian correct.
	- Added DIFF file spec
	- updated tpkg213 which compares md5 on a zonefile for new format.
	- added nsd.conf.5 manual page with a draft contents.

22 Feb 2006: nsd-team
   * Miek: Changed over to Cutest testing framework.
   * Miek: fixed typo in netio.h
   * Miek: fix syntax in rbtree.c put functions on multiple lines.
   * Miek: unit test tpkg for cutest.
   * Wouter: fixed ptr bug in rbtree unit test.

17 Feb 2006: Wouter
	- rbtree_delete is added and works. Unit tests are there too.
	- Changed tail recursion in rbtree_delete to while loop.
	- Tagged this version as NSD_3_signalsocket_solution.
	  It is the stable 2_2 branch with cleanups, portable, and
	  signalhandler solution by socket communication redesign.

15 Feb 2006: nsd-team
   * Wouter: Fixed server_child would wait for two kill signals before quit.
   * Miek: don't check for port==0 pkt, just try to send them. 
	Forward Port of 2.3.
   * Wouter: Removed unused, not substituted, @nsdxfer@ from Makefile.in.

14 Feb 2006: Wouter
	- Added unit tests for rbtree. Extensive testing of all functions.
	- Added tpkg unit test.
	- configure tests for CUnit(optional lib for unit tests). Makefile
	  cleanup so it works on non-gmake on freebsd.

13 Feb 2006: Wouter
	- Removed timespec_add(current_time) in server_main, the timeout was
	  relative, not absolute. This fixes EINVAL on the timeout on freebsd.
	- Added check in configure for compiler flags. Used for -Wextra.
	- Added check in configure for va_list definition conflict between
	  stdio and stdarg. This happens on DEC Alpha/Debian.
	- removed --enable-mmap configure option. There is no mmap support
	  in the current codebase.
	- renamed local prev to next in domain_next() in namedb.h.
	- Removed heap.h. It was not used. Heap and rbtree are mingled anyway.
	- in netio.c, in dispatch, it would store the next pointer 'in case
	  the handler removes itself'. But if the handler removes that next.
	  Then it would fail. So stored the next in struct netio.
	  This removes a potential bug. Netio_dispatch is not reentrant.
	  Reentry would need a list of iterator* in struct netio.
	- Changed process_query() to server_process_query(). It is too 
	  similar to query_process().

10 Feb 2006: nsd-team
   * Wouter: Improved configure.ac to detect pselect in sys/select.
	The check works on freebsd(yes) and fedoracore 3 and 4 (no).
	I hope it also works on Solaris.
	Also various other protoypes were implicit: chroot, strptime, ...
	These are also solved.
   * Wouter: Checked configure on sparc5(solaris). Added check for
	ctime_r in time.h (for tsig.c). This conf also works on freebsd/linux.
   * Wouter: Updated dependencies in makefile for plugin headers.
	These are included only when --enable-plugins is present.
   * Wouter: Added a send quit over socket to kill commands in server_main,
	These act when the fork children fails. If the kill fails, the
	socket command hopefully still works.
   * Wouter: Put reload code into a separate function. It communicates with
	a socket to the old parent, and sends it a quit command. This works
	and terminates the old nsd. Left in the kill as a double failsafe.
	If the reload process dies, then the parent closes the socket.
   * Wouter: Separated the signal mode from the socket-determined nsd->mode.
	Every signal function has a variable, so that multiple signals can
	arrive. Only the number of signals of the same type is lost, but not
	important for nsd. The signals are handled in turn by the run loop.
	This completes the coding to remove signal race conditions:
	- nsd uses sockets to communicate with its subprocesses(server,reload).
	- signal handler routine contains no lengthy system calls.
	- signals cannot overwrite a previous signal.
   * Wouter: fixed problem where nsd->mode and mode are different in 
	server_main. Nsd would kill the children, but then restart them again.

09 Feb 2006: nsd-team
   * Wouter: Updated dependencies in Makefile (regenerated them with gcc -MM).
   * Wouter: Used splint on the source (with settings to reduce spam.)
	And came to the following changes:
	- In util.h, make it respect HAVE_CONFIG_H and HAVE_SYSLOG_H.
	Also it now defines fallback values for #defines in syslog h.
	- Added explicit cast to (unsigned int) in snprintf in dname.c,
	dname_to_string routine.
   * Wouter: Used extra warnings during gcc compile. -Wextra -Wall 
	-pedantic -Wbad-function-cast -Wmissing-declarations 
	-Wmissing-prototypes -Wnested-externs -Wold-style-definition 
	-Wstrict-prototypes -Wdeclaration-after-statement.
	Using -Wtraditional gives too many warnings.
   * Wouter: Found a problem with pselect. sys/select.h does not by default
	provide the pselect function definition. configure script is 
	adjusted to test for this and enable _XOPEN_SOURCE=600 to get it.
	Found this using the gcc warnings.
   * Wouter: dname and rbtree test apps were in make clean target, but
	do not exist anymore. Removed from make clean target.
   * Wouter: in util log_file() the epoch time_t is passed to printf
	without an int cast. Found using extra gcc warnings.
   * Wouter: In server.c fixed some signed-unsigned comparisons
	using the extra gcc warnings.
	- in shutdown and int was used instead of size_t.
	- in server_main timeout(signed) was compared with unsigned.
	- unused variable in new handler functions.
	- in handle_child_command int i instead of size_t was used.
	- in zonec the process_rr routine was missing (void) as paramlist.
   * Wouter: Added -Wall and -Wextra when --enable-checking is enabled.
   * Miek: Ported over the big fat enable checking configure warning.
   * Wouter: fixed configure check for pselect on freebsd.

08 Feb 2006: nsd-team
   * Wouter: In server.c also sockets from unexpectedly dead childs are closed.
   * Wouter: in nsd.c and server.c cleaned out the signal handler, so that
	it only includes two switch/if statements and alters only the mode. 
	No more calls to alarm(), waitpid(), write(), log_msg().
	Instead the work is done in the runloop in server.c and sent by socket.
	Also the parent now waits for children. Parent restarts them.
   * Wouter: Fixup, the children will quit if the parent closes the command
	socket. If parent is killed, they will exit too.
   * Wouter: The server_main now listens to children command channels.
	Included timeout to check for terminated processes.
	Test says that new signal handler works, and child->parent comm.

07 Feb 2006: nsd-team 
   * Miek: configure.ac version to 3.0.0
   * Miek: looked at: buffer.{ch}, answer.{ch}, dns.{ch}
	   those files don't have any changes, except for dns.{ch} for the
	   explicit compression.
   * Miek: looked at: zlexer.lex and zparser.y; only changes there
	for the database changes.
   * Wouter: Changed buffer in write_pid from 16 bytes to 32 bytes, 
	this makes 64 bit numbers fit in the buffer.
   * Wouter: Socket connection between parent and child nsds added.
	But sighandler now in worse shape. Need to close them. Remove kills.
   * Wouter: close the parent and child command channel sockets in shutdown().
