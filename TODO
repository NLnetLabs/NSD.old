$Id$

NOTE: Some of these are probably out of date.

GENERAL
- Check old todo items in this list .

AUTOCONF
(old)+ check whether the --with-nsd-user exists in the system

ZONE COMPILER
(old)+ empty node should not cause NXDOMAIN
(old)- unify dns type table (name, dns type, yacc token, rdata types)
(old)- unify dns class table (name, dns type, yacc token)
(old)- detect cname loops
- one db file per zone (as an option?) (featurecreep)?
  req by Alex (Bit). So that after rsync, zonec is fast with many zones.
- if a zone is dropped from the config file, but not removed from the
  nsd.db. NSD refuses to start. Should skip/drop the zone.
  Redesign file format, so that you can skip a zone more easily, this
  also makes multiply db files easier.

SERVER
(old)- in tcp the timeout should be handled different than with alarm()?
(old)- replace all ntohs(..) with #define .... something[i] and ntohs() it beforehand
(old)- make sure that we dont copy anything from the query we dont want to copy, like
  (old)funny headers etc
(old)- query buffer is now 64k, perhaps we want it smaller? (used to be 1k)
(old)- change default of --enable-ipv6 to yes.
- check if close_all_sockets in server.c also needs to close the parent/child sockets.
- check if after forks you need to close sockets, i.e. if after a loop of reloads/...
  you start running out of fds.

SECURITY

PURITY
(old)- some data is in network order some in host order, make it clear with prefixes
(old)- brush up the fuction and identifiers names

CLEANUP
(old)+ proper error/fatal/warning interfaces
- check LOG_INFO log message and see if they are usefull

DOCUMENTATION
(old)- convert the manual pages into -man macros set for better compatibility?
(old)- update DESIGN document
- doc state diagram reloads and xfrd interaction (expire messages and so on).
- doc AXFR not spec compliant (for axfr-only option).
- if reload dies what log entry, if happens often let us know, we can
  catch the error and do some stuff.
- log entry garbage snip off ixfr file, how often does it happen.
- doc that churn host memory on ixfr/axfr, cannot free, it is in same region
  ixfr is with trusted parties, so not a problem.
- log entry on max tcp count in xfrd, let us know, we can make it a config.
- nsd_for_bind_users: without notify: statements nsd will not send NOTIFY.
  (Bind sends to the NS).

OPTIMISATIONS
- delete entire zone for AFXR during reload read in,
  now walks the tree, but could use a double linked list to speed up.
- less memory churn in deleting RRs/adding RRs: keep rrset->capacity num.
  initial read in capacity==limit, if you want to add RRs, alloc capacity*2.
- less memory churn in deleting rrsets : keep a linked list of deleted rrsets
  for reuse.
- is_existing = 0 used to remove a domain. Check and test carefully.
	- test delete middle zone
	- test delete/add a domain and NXdomain/exist replies.
	- test delet domain and wildcard replies.

- in query_process, for every query incoming and answered, NSD mallocs
  the query name (in dname_make from process_query_section) and
  then frees it (in query reset). This could be a fixed buffer
  (2 + max_labels + maxdomainlen) = 255 + 128 + 2 bytes.
- compress dnames in ixfr queries (write_soa_buffer) (zone 2x, mname, rname).
  small gain, nasty code.
