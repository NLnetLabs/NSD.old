.\"
.\" nsdc.8 -- nsdc manual
.\"
.\" Copyright (c) 2001-2006, NLnet Labs. All rights reserved.
.\"
.\" See LICENSE for the license.
.\"
.Dd @date@
.Os FreeBSD
.Dt nsdc 8 
.Sh NAME
.Nm nsdc
.Nd Name Server Daemon (NSD) Control Script
.Sh SYNOPSIS
.Nm nsdc
.Op Fl c Ar configfile
.Ar start | stop | reload | rebuild | restart | running | update | notify | patch
.Sh DESCRIPTION
.Ic Nsdc
is the shell script that used to control
.Xr nsd 8
and
.Xr zonec 8
from
.Ic NSD
distribution.
.Ic Nsdc
is also suitable to be linked into
.Pa /etc/rc.d
directory on
.Em BSD
like systems for automatic startup of
.Xr nsd 8
at the boot time.
.Pp
At every invokation
.Ic nsdc
will try to read the
.Xr nsd.conf 5
configuration file. An example of such configuration file is distributed
with the
.Ic NSD
package as
.Pa nsd.conf.sample .
The config file is checked for errors before it is used, see
.Xr nsd-checkconf 8 .
.Pp
.Bl -tag -width indent
.It Fl c Ar configfile
Specify configfile to use instead of the default
.Pa /etc/nsd/nsd.conf .
.El
.Pp
Possible
.Ic nsdc
applications are:
.Bl -tag -width indent
.It Ar start
Start
.Xr nsd 8
.It Ar stop
Shut down
.Xr nsd 8
by sending
.Em SIGTERM
to it.
.It Ar reload
Initiate
.Xr nsd 8
name space database reload by sending
.Em SIGHUP
.It Ar rebuild
Rebuild the
.Xr nsd 8
database by invoking
.Xr zonec 8
with appropriate arguments.
.It Ar restart
Restart
.Xr nsdc 8
This equals to nsdc stop && nsdc start
.It Ar running
Check whether
.Xr nsd 8
is running. Returns error message and error code if it is not
running, and no message and zero error code otherwise.
.It Ar update
Updates all the slave zones which have
.Pa allow-notify:
from localhost (127.0.0.1 or ::1) allowed.
If a TSIG key is specified for the allow-notify statement
in the config file, it will be used to secure the notify.
Note that NSD keeps track of zone timeouts automatically,
this is only needed if you want to manually force updates
by sending notify messages to the localhost. 
.Pp
Another method you can use is to stop nsd, delete the xfrd.state
file and then start nsd again. It will try to update all zones.
This method does not require allow-notify: statements.
.It Ar notify
Sends notify messages to all the slaves for all the zones that have the
.Em notify:
keyword in the
.Pa nsd.conf
file. If a TSIG key is specified for a notify statement, it
will be used to secure the notification message to that 
slave server.
.It Ar patch
Merge zone transfer changes back to zone files. It reads in the nsd database 
(nsd.db) and difffile (ixfr.db), and overwrites the zone text files if they 
have been updated. Running this regularly ensures that the difffile does not 
grow infinitely.
.El
.Sh FILES
.Bl -tag -width indent
.It Pa /etc/nsd/nsd.conf
Configuration file for nsd to change default pathnames
and
.Ic NSD
flags. The zone names, pathnames to zone files and access 
control lists are also in 
.Xr nsd.conf 5 .
.It Pa /var/db/nsd/nsd.db
default
.Ic NSD
database
.It Pa /var/db/nsd/nsd.db.lock
Lockfile for nsd database access by operator tools.
.It Pa /var/db/nsd/ixfr.db
Journal of zone transfers, the diff file containing the 
new zone contents transferred.
.It Pa /var/db/nsd/xfrd.state
State for the zone transfer process of NSD. Contains
timeouts for the zones and whether zones are expired.
.It Pa /var/run/nsd.pid
the process id of the name server.
.El
.Sh DIAGNOSTICS
.Ic Nsdc
will return zero return code if operation was successful and
an error message to standard output plus a non-zero return code
otherwise.
.Sh SEE ALSO
.Xr nsd 8 ,
.Xr nsd.conf 5 ,
.Xr nsd-checkconf 8 ,
.Xr nsd-notify 8 ,
.Xr nsd-patch 8 ,
.Xr nsd-xfer 8 ,
.Xr zonec 8
.Sh AUTHORS
.Ic NSD
was written by NLnet LABS and RIPE NCC joint team. Please see CREDITS file
in the distribution for further details.
.Sh BUGS
Syntax checking of the config file is rudimentary and error messages may be
wrong.
If you do a nsdc patch, whilst a (long) zone transfer is busy, the zone 
transfer contents will be partially lost. After a reload, this will be 
detected and the zone transfer should be restarted. The reload that happens
at the end of nsdc patch also frees up memory churn in NSD caused by zone 
transfers.
