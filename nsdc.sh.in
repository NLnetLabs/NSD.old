#!/bin/sh
#
# $Id: nsdc.sh.in,v 1.3 2002/02/19 14:25:11 alexis Exp $
#
# nsdc.sh -- a shall script to manage the beast
#
# Alexis Yushin, <alexis@nlnetlabs.nl>
#
# Copyright (c) 2001, NLnet Labs. All rights reserved.
#
# This software is an open source.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#
# Redistributions of source code must retain the above copyright notice,
# this list of conditions and the following disclaimer.
#
# Redistributions in binary form must reproduce the above copyright notice,
# this list of conditions and the following disclaimer in the documentation
# and/or other materials provided with the distribution.
#
# Neither the name of the NLNET LABS nor the names of its contributors may
# be used to endorse or promote products derived from this software without
# specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
#

#
# Modify the pathnames and settings below to reflect your local configuration
#
NSDBINDIR=@@NSDBINDIR@@
NSDZONESDIR=@@NSDZONESDIR@@
NSDFLAGS=@@NSDFLAGS@@
NSDPIDFILE=@@NSDPIDFILE@@
NSDDB=@@NSDDB@@

#
# You sure heard this many times before: NO USER SERVICEABLE PARTS BELOW
#
signal() {
	if [ -f ${NSDPIDFILE} ]
	then
		kill -"$1" `cat ${NSDPIDFILE}` && return 0
	else
		echo "nsd is not running"
	fi
	return 1
}

case "$1" in
start)
	[ -x ${NSDBINDIR}/nsd ] && ${NSDBINDIR}/nsd -f ${NSDDB}
	;;
stop)
	send_signal "SIGTERM"
	;;
reload)
	send_signal "SIGHUP"
	;;
rebuild)
	if [ -f ${NSDDB} ]
	then
		for i in ${NSDZONESDIR}/*.zone ${NSDZONESDIR}/*.cache
		do
			if [ $i -nt ${NSDDB} ]
			then
				${NSDBINDIR}/zonec -f ${NSDDB} ${NSDZONESDIR}/*.zone ${NSDZONESDIR}/*.cache
				exit 0
			fi
		done
	else
		${NSDBINDIR}/zonec -f ${NSDDB}  ${NSDZONESDIR}/*.zone ${NSDZONESDIR}/*.cache
		exit 0
	fi
	echo "${NSDDB} is up to date"
	;;

restart)
	$0 stop && $0 start
	;;
*)
	echo "Usage: `basename $0` {start|stop|reload|rebuild|restart}" >&2
	;;
esac

exit 0
